<!DOCTYPE html>

<html lang="ru">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<title>Balloons</title>
<style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #F1F2EE;
      font-family: Roboto;
      font-weight: 400;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #container {
      text-align: center;
      background: #F1F2EE;
      border-radius: 20px;
      padding: 10px 30px;
    }
    h1 {
      margin: 5px 0;
      font-size: 20px;
      color: #3399ff;
    }
    #score {
      font-size: 18px;
      font-family: monospace;
      font-weight: bold;
      color: #1c1c1c;
      margin-bottom: 20px;
      padding-top: 15px;
      padding-bottom: 15px;
      border: 0.1px solid;
      border-color: #363537;
      border-radius: 50px;
    }
    #board {
      width: 504px;
      height: 462px;
      position: relative;
      background: #F1F2EE;
      border: 1px solid #000000;
      border: none;
      border-radius: 20px;
    }
    .cell {
      width: 37px;
      height: 37px;
      border-radius: 50%;
      position: absolute;
      transition: top 0.1s ease-in, left 0.1s ease-in;
      background-blend-mode: overlay;
    }
    .highlight {
      outline: 2px dashed #1c1c1c;
      background: #1c1c1c;
    }
    #newGame {
      box-sizing: border-box;
      background: #2D7DD2;
      font-size: 18px;
      border: none;
      cursor: pointer;
    }
    #newGame:hover {
      font-weight: bold;
      background: #F45D01;
      transition: 0.2s ease-in;
    }
  </style>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
.swal2-popup-custom {
  font-family: sans-serif;
  font-size: 16px;
  padding: 1em 1.5em;
  border: 2px solid #3399ff;
  box-shadow: none;
}
</style>
<link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA30lEQVR4nO1XQRKDMAgsTD/Ts/7/Bebc59hTnTEhwCZCPZQjkt1lg4nSA4x9WXbtOZVCCJ6r2CKdEcNR5N61XYUzxCJRxw3RgavJNcxGQAS5hs1WQbQIcwij4xCQ0b3ExdnktYjnMMK2vZrcur5RmLEZkMi1vBIE2+8hAZzAHPB2CDjhF4Da66y/zznwF3B/Aegh46xn6BvOK8JZR6UQvgUWOOjU2Az0SAbugsP+7Bvxu/VcJzLJTwJ+FScBGS7UHI0DkSIkbHELIkT0ME2i2bfDasYcwhk3PGth8Kt/zz+sIGUegYTpswAAAABJRU5ErkJggg==" rel="icon" type="image/png"/>
<style>
.ball-wrapper {
    position: relative;
    width: 40px;
    height: 40px;
}
.ball {
    position: relative;
    z-index: 1;
}
.mask-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 40px;
    height: 40px;
    z-index: 2;
    pointer-events: none;
}
</style>
<style>
  #darkModeToggle {
    position: fixed;
    bottom: 40px;
    right: 40px;
    z-index: 1000;
  }
  #toggleSwitch {
    height: 0;
    width: 0;
    visibility: hidden;
    background: #001011;
  }
  #toggleSwitch + label {
    cursor: pointer;
    text-indent: -9999px;
    width: 50px;
    height: 25px;
    background: #001011;
    display: block;
    border-radius: 100px;
    position: relative;
    transition: background 1s;
  }
  #toggleSwitch + label:after {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    width: 21px;
    height: 21px;
    background: #F1F2EE;
    border-radius: 90px;
    transition: 0.3s;
  }
  #toggleSwitch:checked + label {
    background: #F1F2EE;
  }
  #toggleSwitch:checked + label:after {
    left: calc(100% - 2px);
    transform: translateX(-100%);
    background: #001011;
  }

  body.dark-mode, html.dark-mode {
    background: #001011 !important;
    color: #f0f0f0 !important;
  }

  body.dark-mode #container {
    background: #001011 !important;
  }
  body.dark-mode #board {
    background: #001011 !important;
  }
    
  body.dark-mode #score {
    border: 1px solid #F1F2EE;
    color: #F1F2EE;
  }
  
  body.dark-mode #newgame {
    background-color: #F1F2EE;      
  }
    
  body.dark-mode #help-button {
    border: 1px solid;
    border-color: #F1F2EE;  
  }
    
  body.dark-mode #form-button {
    border: 1px solid;
    border-color: #F1F2EE;
  }
  body.dark-mode #score {
    background: #1c1c1c;
    border: none;
  }
  body.dark-mode #newGame {
    border: 1px solid;
    border-color: #F1F2EE;     
  }
    
  body.dark-mode #highlight {
    outline: 2px dashed #F1F2EE;
    background: #F1F2EE;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const toggle = document.getElementById("toggleSwitch");
    toggle.addEventListener("change", function() {
      document.body.classList.toggle("dark-mode");
      document.documentElement.classList.toggle("dark-mode");
    });
  });
</script>

<style>

#newGame {
  position: absolute;
  top: 110px;
  right: 25px;
  width: 32px;
  height: 32px;
  background: #001011;
  color: #F1F2EE;
  font-size: 20px;
  font-weight: bold;
  border-radius: 50%;
  text-align: center;
  line-height: 28px;
  cursor: pointer;
  transition: background 0.3s, transform 0.3s;
  z-index: 1000;   
}

#newGame:hover {
  background: #001011;
  transform: scale(1.2);
  background: #F45D01;
}
    
#form-button {
  position: absolute;
  top: 160px;
  right: 25px;
  width: 32px;
  height: 32px;
  background: #001011;
  color: #F1F2EE;
  font-size: 20px;
  font-weight: bold;
  border-radius: 50%;
  text-align: center;
  line-height: 28px;
  cursor: pointer;
  transition: background 0.7s, transform 0.3s;
  z-index: 1000;    
}
  #form-button:hover {
  background: #2D7DD2;
  transform: scale(1.2);
}
    
#help-button {
  position: absolute;
  top: 210px;
  right: 25px;
  width: 32px;
  height: 32px;
  background: #001011;
  color: #F1F2EE;
  font-size: 20px;
  font-weight: bold;
  border-radius: 50%;
  text-align: center;
  line-height: 32px;
  cursor: pointer;
  transition: background 0.3s, transform 0.3s;
  z-index: 1000;
}
#help-button:hover {
  background: #EEB902;
  transform: scale(1.2);
}
#help-popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #222;
  color: #eee;
  border: 2px solid #444;
  border-radius: 12px;
  padding: 20px;
  z-index: 2000;
}
.help-content h2 {
  margin-top: 0;
  color: #fff;
}
.help-content ul {
  margin: 0;
  padding-left: 20px;
}
.help-content button {
  margin-top: 12px;
  padding: 6px 12px;
  background: #444;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.1s;
}
.help-content button:hover {
  background: #666;
}
</style>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">


<style>
  #splash {
    position: fixed;
    z-index: 9999;
    inset: 0;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .splash-ball {
    width: 40px;
    height: 40px;
    background: #4fc3f7;
    border-radius: 50%;
    animation: pulse 1.2s infinite ease-in-out;
  }
  @keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); opacity: 0.6; }
    100% { transform: scale(1); opacity: 1; }
  }
</style>

</head>
<body>

<div id="splash"><div class="splash-ball"></div></div>

<div id="container">
<!-- <h1>● Jawbreaker</h1> -->
<div id="score">Счёт: 0</div>
<div id="board"></div>
<button id="newGame">⟳</button>
</div>
<script>
    const colors = ["#F45D01", "#97CC04", "#2D7DD2", "#EEB902", "#68B0AB"]
    const rows = 11, cols = 12, cellSize = 42;
    const board = [];
    let score = 0;

    const boardEl = document.getElementById('board');
    const scoreEl = document.getElementById('score');
    const clickSound = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAABAAgAZGF0YQAAAAA=");
    const popSound = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAABAAgAZGF0YQAAAAA=");

    document.getElementById("newGame").onclick = () => init();

    function init() {
      boardEl.innerHTML = "";
      board.length = 0;
      score = 0;
      scoreEl.textContent = "Счёт: 0";

      for (let y = 0; y < rows; y++) {
        board[y] = [];
        for (let x = 0; x < cols; x++) {
          const color = colors[Math.floor(Math.random() * colors.length)];
          const div = document.createElement("div");
          div.className = "cell";
          div.style.background = color;
          div.style.opacity = 2;
          board[y][x] = { color, div };
          div.dataset.x = x;
          div.dataset.y = y;
          div.onclick = handleClick;
          div.onmouseenter = handleHover;
          div.onmouseleave = clearHighlights;
          boardEl.appendChild(div);
        }
      }

      positionAll();
    }

    function positionAll() {
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const cell = board[y][x];
          if (cell && cell.div) {
            cell.div.style.left = `${x * cellSize}px`;
            cell.div.style.top = `${y * cellSize}px`;
          }
        }
      }
    }

    function handleHover(e) {
      const x = +e.target.dataset.x;
      const y = +e.target.dataset.y;
      const group = getGroup(x, y);
      clearHighlights();
      if (group.length >= 2) {
        group.forEach(p => board[p.y][p.x].div.classList.add("highlight"));
        clickSound.currentTime = 0; clickSound.play();
      }
    }

    function clearHighlights() {
      document.querySelectorAll(".highlight").forEach(d => d.classList.remove("highlight"));
    }

    function handleClick(e) {
      const x = +e.target.dataset.x;
      const y = +e.target.dataset.y;
      const group = getGroup(x, y);
      if (group.length < 2) return;

      popSound.currentTime = 0; popSound.play();
      group.forEach(p => {
        boardEl.removeChild(board[p.y][p.x].div);
        board[p.y][p.x] = null;
      });

      score += group.length * (group.length - 1);
      scoreEl.textContent = "Счёт: " + score;

      collapse(() => {
        if (!hasMoves()) {
          
setTimeout(() => Swal.fire({
  title: 'Игра окончена!',
  text: `Итог: ${score}`,
  icon: 'error',
  confirmButtonText: 'Новая игра',
  confirmButtonColor: '#2D7DD2',
  background: '#FFFDF6',
  color: '#2D7DD2',
  customClass: {
    popup: 'swal2-popup-custom'
  }
}), 200);

        }
      });
    }

    function getGroup(x, y) {
      const color = board[y][x]?.color;
      if (!color) return [];
      const visited = Array.from({length: rows}, () => Array(cols).fill(false));
      const group = [];
      const stack = [{x, y}];

      while (stack.length) {
        const {x, y} = stack.pop();
        if (x < 0 || x >= cols || y < 0 || y >= rows) continue;
        if (visited[y][x] || board[y][x]?.color !== color) continue;
        visited[y][x] = true;
        group.push({x, y});
        stack.push({x: x+1, y}, {x: x-1, y}, {x, y: y+1}, {x, y: y-1});
      }

      return group;
    }

    function collapse(callback) {
      for (let x = 0; x < cols; x++) {
        let pointer = rows - 1;
        for (let y = rows - 1; y >= 0; y--) {
          if (board[y][x]) {
            if (y !== pointer) {
              board[pointer][x] = board[y][x];
              board[pointer][x].div.dataset.y = pointer;
              board[y][x] = null;
            }
            pointer--;
          }
        }
      }

      let writeCol = 0;
      for (let readCol = 0; readCol < cols; readCol++) {
        if (board.some(row => row[readCol])) {
          if (writeCol !== readCol) {
            for (let y = 0; y < rows; y++) {
              board[y][writeCol] = board[y][readCol];
              if (board[y][writeCol]) {
                board[y][writeCol].div.dataset.x = writeCol;
              }
              board[y][readCol] = null;
            }
          }
          writeCol++;
        }
      }

      for (let x = writeCol; x < cols; x++) {
        for (let y = 0; y < rows; y++) {
          board[y][x] = null;
        }
      }

      positionAll();
      if (callback) setTimeout(callback, 300);
    }

    function hasMoves() {
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const c = board[y][x]?.color;
          if (!c) continue;
          for (const [dx, dy] of [[1,0],[0,1]]) {
            const nx = x + dx, ny = y + dy;
            if (nx < cols && ny < rows && board[ny][nx]?.color === c) return true;
          }
        }
      }
      return false;
    }

    init();
  </script>

<div id="darkModeToggle">
<input id="toggleSwitch" type="checkbox"/>
<label for="toggleSwitch"></label>
</div>

<!-- Help Button -->
<div id="help-button" title="Помощь">?</div>
<!-- Form Button -->
<div id="form-button" title="Изменить форму">■</div>

<script>
document.getElementById("form-button").onclick = function () {
  document.getElementById(".cell").style.display = "border-radius: 20px;";
};
function closeHelp() {
  document.getElementById("help-popup").style.display = "none";
}
</script>

<!-- Help Popup -->
<div id="help-popup">
  <div class="help-content">
    <h2>Как играть</h2>
    <p>Нажмите на группу шариков одного цвета, чтобы удалить их с поля.</p>
    <p>Чем больше группа, тем больше очков:</p>
    <ul>
      <li>2 шарика — 2 очка</li>
      <li>3 — 6 очков</li>
      <li>4 — 12 очков</li>
      <li>5 — 20 очков</li>
      <li>6+ — по формуле: N × (N - 1)</li>
    </ul>
    <button onclick="closeHelp()">Понятно</button>
  </div>
</div>

<script>
document.getElementById("help-button").onclick = function () {
  document.getElementById("help-popup").style.display = "block";
};
function closeHelp() {
  document.getElementById("help-popup").style.display = "none";
}
</script>


<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker registered'))
      .catch(err => console.error('SW registration failed:', err));
  }
</script>


<script>
  window.addEventListener('load', () => {
    const splash = document.getElementById('splash');
    if (splash) splash.remove();
  });
</script>

</body>
</html>
